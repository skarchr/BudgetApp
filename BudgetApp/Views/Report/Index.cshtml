@using BudgetApp.Controllers
@using BudgetApp.Extensions
@model ReportController.ReportViewModel 

@{
    ViewBag.Title = "Report";
}

<div class="row" ng-controller="reportController">
    
    <div class="col-xs-12" style="border:2px solid #0094FF; -ms-border-radius: 40px; border-radius: 40px;">
       
        <ul class="list-unstyled list-inline" role="tablist" style="margin-top:-20px;">
            <li role="presentation" class="active">
                <a href="#chart" aria-controls="chart" role="tab" data-toggle="tab" class="btn btn-default btn-nav btn-sm btn-round text-center {{selected === 'charts' ? 'active':''}}" style="min-width: 40px;" ng-click="selected = 'charts'">
                    <i class="glyphicon glyphicon-signal"></i>
                </a>
            </li>
            <li role="presentation" style="margin-left: -10px;">
                <a href="#table" aria-controls="table" role="tab" data-toggle="tab" class="btn btn-default btn-nav btn-sm btn-round text-center {{selected === 'tables' ? 'active':''}}" style="min-width: 40px;" ng-click="selected = 'tables'">
                    <i class="glyphicon glyphicon-th"></i>
                </a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="chart" style="margin-bottom: 40px;">

                <form class="form-horizontal" style="margin-top:40px;" name="chartForm" novalidate>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">Choose chart</label>
                        <div class="col-sm-10">
                            <ul class="list-unstyled">
                                @foreach (var chart in Model.Charts)
                                {
                                    <li>
                                        <div class="radio">
                                            <label>
                                                <input type="radio" name="name" id="name" ng-model="chartModel.name" value="@chart" required />
                                                @chart.Replace('_', ' ')
                                            </label>
                                        </div>
                                    </li>
                                }
                            </ul>

                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">Date range</label>
                        <div class="col-sm-10 form-inline">
                            <input type="date" class="form-control" name="fromDate" id="fromDate" ng-model="chartModel.fromDate" max="{{chartModel.toDate | date: 'yyyy-MM-dd'}}" required />
                            -
                            <input type="date" class="form-control" name="toDate" id="toDate" ng-model="chartModel.toDate" min="{{chartModel.fromDate | date: 'yyyy-MM-dd'}}" max="{{today | date: 'yyyy-MM-dd'}}" required />
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label">Categories</label>
                        <div class="col-sm-10 form-inline">
                            <ul class="list-unstyled list-inline">
                                @for(var i = 0; i < Model.Categories.Count; i++)
                                {
                                    <li>
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" ng-click="toggleCategory('@Model.Categories[i]')" checked="checked" />
                                                @CategoryExt.CamelCaseToNormal(Model.Categories[i])
                                            </label>
                                        </div>
                                    </li>  
                                }
                            </ul>
                        
                        </div>
                    </div>

                    <div class="form-group" ng-show="chartModel.name === '@ReportController.SPC'">
                        <label class="col-sm-2 control-label">Range</label>
                        <div class="col-sm-10 form-inline">
                            <select ng-model="chartModel.range" class="form-control">
                                <option value="0">Daily</option>
                                <option value="1">Weekly</option>
                                <option value="2">Monthly</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" ng-show="chartModel.name === '@ReportController.Drilldown'">
                        <label class="col-sm-2 control-label">Chart type</label>
                        <div class="col-sm-10 form-inline">
                            <select ng-model="chartModel.chartType" class="form-control">
                                <option value="column">Column</option>
                                <option value="pie">Pie</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10 form-inline">
                            <button ng-disabled="chartForm.$invalid || chartModel.categories.length === 0" class="btn btn-primary" data-get-chart-view>Generate</button>
                        </div>
                    </div>

                </form>



                <div id="chartView"></div>
            </div>
            <div role="tabpanel" class="tab-pane" id="table">
                <div id="tableView"></div>
            </div>
        </div>


    </div>    

</div>
<script src="~/bower_components/highstock-release/modules/exporting.js"></script>
<script src="~/js/directives/ReportDirectives.js"></script>
<script>
    (function() {
        'use strict';

        angular.module('budgetApp').factory('reportFactory', function() {
            return {
                model:@Html.Raw(Model.ToJson())
            };
        });

    })();
</script>