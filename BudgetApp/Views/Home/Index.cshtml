@using BudgetApp.Extensions
@model BudgetApp.Models.HomeViewModel
@{
    ViewBag.Title = "Home";
}

<div class="row" ng-controller="homeController" style="margin-top:30px;">
   
    @if (Model.Transactions.Count == 0)
    {

        <div class="jumbotron" fade-in="100">

            <div id="icon" style="width: 30%;">
                <object>
                    <img src="~/Content/images/logo_pig.svg" id="svg" />
                </object>
            </div>

            <h1 class="hidden-xs hidden-sm text-center" style="margin-top: -40px;">You have no transactions registered</h1>
            <h2 class="visible-xs visible-sm text-center">You have no transactions registered</h2>

            <div class="row">
                <div class="col-xs-12 col-md-6 text-center">
                    <button class="btn btn-primary btn-xlg" onclick=" location.href='@Url.Action("Create", "Transactions")' ">
                        Add transaction
                    </button>

                </div>
                <div class="col-xs-12 col-md-6 text-center">
                    <button class="btn btn-primary btn-xlg" onclick=" location.href='@Url.Action("Upload", "Transactions")' ">
                        Import transactions
                    </button>
                </div>
            </div>

        </div>

    }
    else
    {

        <div role="tabpanel" class="col-xs-12" ng-show="model.expensesGoal !== null">

            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#expense" aria-controls="expense" role="tab" data-toggle="tab" title="Shows an overview for all your registered transactions">All transactions</a></li>
                <li role="presentation"><a href="#income" aria-controls="income" role="tab" data-toggle="tab" reflow-charts title="Shows an overview for the transactions during the year @DateTime.Now.Year">Current year</a></li>

                <li class="pull-right" role="presentation"><a href="#prediction" aria-controls="prediction" role="tab" data-toggle="tab">Prognosis</a></li>
                <li ng-show="model.savingGoal" class="pull-right" role="presentation">
                    <a href="#saving" aria-controls="saving" role="tab" data-toggle="tab">
                        Savings
                    </a>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="expense">

                    <div class="col-xs-12">

                        <div class="row" style="margin-top: 10px;">

                            <div class="col-xs-12">                                
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.AverageDailyExpenses" data-goal="@((Model.ExpensesGoal * 12) / 365)" data-currency="@Model.Currency" data-chart-title="Daily expenses"></div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.AverageMonthlyExpenses" data-goal="@((Model.ExpensesGoal))" data-currency="@Model.Currency" data-chart-title="Monthly expenses"></div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.AverageDailyIncome" data-goal="@(Model.AverageDailyExpenses) / 365)" data-currency="@Model.Currency" data-chart-title="Daily income" data-inverted="true"></div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.AverageMonthlyIncome" data-goal="@((Model.AverageMonthlyExpenses))" data-currency="@Model.Currency" data-chart-title="Monthly income" data-inverted="true"></div>
                                </div>
                            </div>
                            
                        </div>
                        

                        <div class="row" style="margin-top: 20px;">


                            <div class="col-xs-12">

                                <span style="height:500px;width:1123px !important;" class="visible-lg" data-highchart="{{model.drilldownGraphTot}}"></span>

                                <span style="height:500px;width:923px !important;" class="visible-md" data-highchart="{{model.drilldownGraphTot}}"></span>

                                <span style="height:500px;width:703px !important;" class="visible-sm" data-highchart="{{model.drilldownGraphTot}}"></span>

                            </div>

                        </div>

                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="income">
                    <div class="col-xs-12">

                        <div class="row" style="margin-top: 10px;">

                            <div class="col-xs-12">
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.CurrentMonthExpenses" data-goal="@((Model.ExpensesGoal))" data-currency="@Model.Currency" data-chart-title="Expenses for @(DateHelper.GetMonthText(DateTime.Now))"></div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.YtdExpenses" data-goal="@(Model.ExpensesGoal *  DateTime.Now.Month)" data-currency="@Model.Currency" data-chart-title="Expenses for @(DateTime.Now.Year)"></div>
                                </div>
                                
                                <div class="col-xs-12 col-sm-6 col-md-3" style="padding:0">
                                    <div style="height: 200px;" data-vu-meter="@Model.YtdIncome" data-goal="@(Model.YtdExpenses)" data-currency="@Model.Currency" data-chart-title="Income for @(DateTime.Now.Year)" data-inverted="true"></div>
                                </div>

                            </div>

                        </div>
                        
                        <div class="row" style="margin-top: 20px;">


                            <div class="col-xs-12">

                                <span style="height:500px;width:1123px !important;" class="visible-lg" data-highchart="{{model.drilldownGraphYtd}}"></span>

                                <span style="height:500px;width:923px !important;" class="visible-md" data-highchart="{{model.drilldownGraphYtd}}"></span>

                                <span style="height:500px;width:703px !important;" class="visible-sm" data-highchart="{{model.drilldownGraphYtd}}"></span>

                            </div>

                        </div>

                    </div>
                </div>
                <div role="tabpanel" class="tab-pane" id="saving">                   
                    
                    @*TODO:Fix*@
                    <div class="col-xs-12 text-center">
                        <span>
                            <i class="glyphicon glyphicon-star" style="color:#F0F088;font-size:60px;"></i>
                            <span style="position: absolute;margin-top: 24px;margin-left: {{ -(starCountNeg.toString().length + 39) + 'px' }};font-size:18px;">{{starCountPos}}</span>
                        </span>
                        <span>
                            <i class="glyphicon glyphicon-star" style="color:#E87C7C;font-size:60px;"></i>
                            <span style="position: absolute;margin-top: 24px;margin-left: {{ -(starCountNeg.toString().length + 40) + 'px' }};font-size:18px;">{{starCountNeg}}</span>
                        </span>
                    </div>

                    <div class="col-xs-12" ng-repeat="goal in model.savingGoals">

                        <h3>{{goal.date | date : 'MMM, yyyy'}} <i ng-show="model.savingGoal <= goal.saved" style="color:#F0F088;" class="glyphicon glyphicon-star"></i> </h3>

                        <div class="progress">
                            <div class="progress-bar {{goal.saved >= model.savingGoal ? 'progress-bar-success':''}}" role="progressbar" aria-valuenow="goal.saved" aria-valuemin="0" aria-valuemax="100" style="width:{{ goal.percentage }}%">                               
                            </div>
                        </div>
                        <div class="text-center">
                            {{goal.saved | currencyFormatter}}/{{model.savingGoal | currencyFormatter}} {{model.currency}}
                        </div>

                    </div>

                </div>
                <div role="tabpanel" class="tab-pane" id="prediction">
                    <div class="col-xs-12">
                        
                        <div class="row" style="margin-top: 20px;">


                            <div class="col-xs-12">

                                <span style="height:500px;width:1123px !important;" class="visible-lg" data-prog-highchart="{{model.prognosisChart}}"></span>

                                <span style="height:500px;width:923px !important;" class="visible-md" data-prog-highchart="{{model.prognosisChart}}"></span>

                                <span style="height:500px;width:703px !important;" class="visible-sm" data-prog-highchart="{{model.prognosisChart}}"></span>

                            </div>

                        </div>
                        
                        <div class="row" style="margin-top: 20px;">


                            <div class="col-xs-12">

                                <span style="height:500px;width:1123px !important;" class="visible-lg" data-prog-highchart="{{model.prognosisIncomeChart}}"></span>

                                <span style="height:500px;width:923px !important;" class="visible-md" data-prog-highchart="{{model.prognosisIncomeChart}}"></span>

                                <span style="height:500px;width:703px !important;" class="visible-sm" data-prog-highchart="{{model.prognosisIncomeChart}}"></span>

                            </div>

                        </div>

                    </div>
                </div>
            </div>
            <hr />
        </div>
    }
    

</div>

<script>
    (function() {
        'use strict';

        angular.module('budgetApp').factory('homeViewModel', function() {

            return {
                model:@Html.Raw(Model.ToJson())
            };

        });

    })();

</script>